#!/bin/bash
ICON="icon: \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmVyc2lvbj0iMSI+CiA8cGF0aCBzdHlsZT0ib3BhY2l0eTowLjIiIGQ9Ik0gMzAsMjIgSCAxOCB2IDE1IGwgMTIsOCB6Ii8+CiA8cGF0aCBzdHlsZT0ib3BhY2l0eTowLjIiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDAuNjY4NTEwODMsMCw0LjA0MDQ0ODgpIiBkPSJNIDQuOTk5OTk5OSw0LjQyNzA4MTUgMjQsNC40MjcwODIxIDQzLDQuNDI3MDgwNyAzMy40OTk5OTksMjAuODgxNTYzIDI0LDM3LjMzNjA0NiAxNC41MDAwMDEsMjAuODgxNTYzIFoiLz4KIDxwYXRoIHN0eWxlPSJmaWxsOiNlNTM5MzUiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDAuNjY4NTEwODMsMCwzLjA0MDQ0ODgpIiBkPSJNIDQuOTk5OTk5OSw0LjQyNzA4MTUgMjQsNC40MjcwODIxIDQzLDQuNDI3MDgwNyAzMy40OTk5OTksMjAuODgxNTYzIDI0LDM3LjMzNjA0NiAxNC41MDAwMDEsMjAuODgxNTYzIFoiLz4KIDxyZWN0IHN0eWxlPSJvcGFjaXR5OjAuMiIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQiIHg9IjQiIHk9IjUiIHJ4PSIyIiByeT0iMiIvPgogPHJlY3Qgc3R5bGU9ImZpbGw6I2VjNmI2OCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQiIHg9IjQiIHk9IjQiIHJ4PSIyIiByeT0iMiIvPgogPHBhdGggc3R5bGU9ImZpbGw6I2I0MjMxZiIgZD0iTSAzMCwyMSBIIDE4IHYgMTUgbCAxMiw4IHoiLz4KIDxwYXRoIHN0eWxlPSJvcGFjaXR5OjAuMjtmaWxsOiNmZmZmZmYiIGQ9Ik0gNiA0IEMgNC44OTIgNCA0IDQuODkyIDQgNiBDIDQgNi4xNzM4MzQ4IDQuMDI5MDEwNSA2LjMzOTQwOTQgNC4wNzAzMTI1IDYuNSBDIDQuMjkyMjYzOCA1LjYzNzAwNjkgNS4wNjU4MzQ4IDUgNiA1IEwgNDIgNSBDIDQyLjkzNDE2NSA1IDQzLjcwNzczNiA1LjYzNzAwNjkgNDMuOTI5Njg4IDYuNSBDIDQzLjk3MDk4OSA2LjMzOTQwOTQgNDQgNi4xNzM4MzQ4IDQ0IDYgQyA0NCA0Ljg5MiA0My4xMDggNCA0MiA0IEwgNiA0IHoiLz4KPC9zdmc+Cg==\","
echo -n $ICON > icon.b64 
curl -s "https://www.unpkg.com/@adguard/tsurlfilter@2.2.19/dist/tsurlfilter.umd.min.js" -o tsurlfilter.js
sed -e "/\/\/TSURLFILERUMD/r tsurlfilter.js" -e "/\/\/TSURLFILERUMD/d" "anuraadblock.js" > bundled.js
sed -e "/BASE64ICON/r icon.b64" -e "/BASE64ICON/d" "bundled.js" > dist.js
rm bundled.js
rm tsurlfilter.js
rm icon.b64